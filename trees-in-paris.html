<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pauline Baudry</title>
    <link rel="stylesheet" href="./style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Poppins:400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:600" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Baskerville:400" rel="stylesheet">


    <!--JAVASCRIPT-->
      <script type='text/javascript' src='https://code.jquery.com/jquery-1.10.2.min.js?ver=1.10.2'></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js" type="text/javascript"></script>
      <script src="https://d3js.org/d3.v4.js"></script>
      <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
      <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
      <script src="https://d3js.org/topojson.v2.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>



  <style>
  .grid line {
    stroke: lightgrey;
    stroke-opacity: 0.7;
    shape-rendering: crispEdges;
  }
  </style>


  </head>
  <body>
    <div id ="header-general">
      <div class="container">

      <div class="row">

    <div class="col-sm-8">
      <div id = "title">
        <a href = "https://paulinebaudry.com/about">
      <h1>Pauline Baudry</h1>
    </a>
    </div>
  </div>

    <div class="col-sm-4">
      <div id = "menu">
        <div class="row">

        <div class="col-sm-6">
        <a href="https://paulinebaudry.com/about">
      <h3>ABOUT</h3>
      </a>
      </div>

    <div class="col-sm-6">
    <a href="https://paulinebaudry.com/index">
      <h3>WORK</h3>
    </a>
    </div>

    </div>
  </div>
  </div>


      </div>
    </div>
    </div>

    <div id ="middle">
      <div class="container-fluid-article">
        <div id = "content-box">
          <div class="row">
            <div class="col-sm-12">
              <div id="title-intro">
          <h3>Urban treescapes</h3>
          <h5>Visualising tree-planting in Paris</h5>
          <h6>September 9, 2022</h6>
          <br>
          </div>
          </div>
          </div>

            <div class="row">
                <div class="col-sm-1"></div>
              <div class="col-sm-10">
                <div id ="data-viz">
                  <h4>Evolution of tree-planting in Paris (November 2021-July 2022) </h4>
                  <div id = "map_trees">
		<!-- 	<div id="my_dataviz" width = 100% height = "500"></div>-->
			<div svg="my_dataviz"></div>
		 					<button id = "play-button" class="btn btn-secondary">Play</button>
						<button id = "reset-button" class="btn btn-outline-secondary">Reset</button>
				</div>

            </div>
              </div>
                <div class="col-sm-1"></div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <div id ="data-viz-text">
                  <h6>Data source: Paris Open Data portal (<a href = "https://opendata.paris.fr/explore/dataset/les-arbres-plantes/information/"target="_blank">planted trees</a> and <a href="https://opendata.paris.fr/explore/dataset/arbres-abattus-pour-raison-sanitaires-et-essence-de-remplacement/information/?disjunctive.domanialite&disjunctive.arrondissement&disjunctive.genrefutur&disjunctive.especefutur&disjunctive.varieteoucultivarfutur&disjunctive.especearbreprecedent&disjunctive.genrearbreprecedent&disjunctive.motifabattagearbreprecedent&disjunctive.libellefrancaisarbreprecedent"target="_blank">felled trees</a>).</h6>
                  <h6>Made using D3.js</h6>
                  <br>
                </div>
              </div>
            </div>

              <div class="row">

        <div class="col-sm-12">
          <div id ="data-viz-article-text">
            <p>		If you imagine a sustainable city, what do you see?</p>

		<p>It is likely you will picture some greenery – a green roof, a couple of trees, a park or even an urban forest. It first comes to mind as it is a visible indicator of sustainability, and rightly so as trees contribute greatly to preserving the environment.</p>

		<p>Trees are not only nice to look at (so nice in fact that <a href = "https://www.weforum.org/agenda/2021/04/city-trees-reduce-stress-and-anxiety/"target="_blank">studies have shown they contribute to lowering stress levels</a>), but they are also hugely beneficial for regulating urban temperatures, filtering pollutants in the air and preserving biodiversity. The list of positive impacts has not gone unnoticed to the city of Paris, which has produced a roadmap for the next couple of years around preserving this particular asset, which is described within the public manifest as the city’s “best ally to face climate change” (<a href = "https://cdn.paris.fr/paris/2021/12/13/daf6cce214190a66c7919b34989cf1ed.pdf"target="_blank">Plan Arbre</a>).</p>

		<p>Paris counts approximately 500 000 trees, including 300 000 in the two main woods (bois de Boulogne and bois de Vincennes), 100 000 in the streets, and 100 000 in remaining public spaces such as parks, gardens, cemeteries, etc. The objective set by Anne Hidalgo, mayor of Paris, is to plant no less than 170 000 additional trees under the course of her mandate (that is, 2020-2026).</p>

		<p>This visualisation aims to show the progress made to reach this ambitious goal, mapping the trees that have been planted and those that have been felled between end of 2021 and summer of 2022. </p>


          </div>
        </div>

      </div>


    </div>
    </div>
  </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>


    <script>

var svg = d3.select("div#map_trees")
   .append("div")
   // Container class to make it responsive.
   .classed("svg-container", true)
   .append("svg")
   // Responsive SVG needs these 2 attributes and no width and height attr.
   .attr("preserveAspectRatio", "xMinYMin meet")
   .attr("viewBox", "0 0 600 400")
   // Class to make it responsive.
   .classed("svg-content-responsive", true)
   // Fill with a rectangle for visualization.
	 .append('text')
		.attr("preserveAspectRatio", "xMinYMin meet")
	 	.attr("font-size", "20px")
	 	.attr("opacity", "0.4")
	 	.attr("text-anchor", "middle")


// The svg
var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

// Map and projection
var projection = d3.geoMercator()
    .center([2.3772, 48.8512])                // GPS of location to zoom on
    .scale(120000)                       // This is like the zoom
    .translate([ 350, 180 ])


// time parsers/formatters
const parseTime = d3.timeParse("%Y-%m-%d")
const formatTime = d3.timeFormat("%Y-%m-%d")

let time = 0
let interval

const timeLabel = svg.append("text")
	.attr("y", 310)
	.attr("x", 100)
	.attr("font-size", "20px")
	.attr("opacity", "0.4")
	.attr("text-anchor", "middle")
	.text(" ")

	var trees = 0
	var felled = 0

	const treeCount = svg.append("text")
		.attr("y", 20)
		.attr("x", 450)
		.attr("font-size", "16px")
		.style('fill','green')
		.attr("opacity", "1")
		.attr("text-anchor", "right")
		.text(trees + " trees planted")

		const treeFelled = svg.append("text")
			.attr("y", 50)
			.attr("x", 450)
			.attr("font-size", "16px")
			.style('fill','black')
			.attr("opacity", "1")
			.attr("text-anchor", "right")
			.text(felled + " trees felled")


	var myCircles = svg.selectAll("circle")

// Load external data and boot
d3.json("https://france-geojson.gregoiredavid.fr/repo/departements/75-paris/communes-75-paris.geojson", function(data){

      // Draw the map
    svg.append("g")
        .selectAll("path")
        .data(data.features)
        .enter()
        .append("path")
          .attr("fill", "#E8E8E8")
          .attr("d", d3.geoPath()
              .projection(projection)
          )
        .style("stroke", "white")

        })


//Add trees
d3.json("https://opendata.paris.fr/api/records/1.0/search/?dataset=les-arbres-plantes&q=&rows=3000", function(data) {

	d3.json("https://opendata.paris.fr/api/records/1.0/search/?dataset=arbres-abattus-pour-raison-sanitaires-et-essence-de-remplacement&q=&rows=800&facet=domanialite&facet=arrondissement&facet=genrefutur&facet=datedernierabattage&facet=especefutur&facet=varieteoucultivarfutur&facet=especearbreprecedent&facet=genrearbreprecedent&facet=motifabattagearbreprecedent&facet=libellefrancaisarbreprecedent", function(data2){


//CLEAN DATA OF PLANTED TREES
				const filteredData = data["records"]
				//Filter out data points that are outside of Paris
				  .filter(function(d){
				      return d.fields.arrondissement.includes("PARIS")})
				//Format date
				  filteredData.forEach(function(d){
				    d.fields.dateplantation = d.fields.dateplantation.substring(0,10);
				    d.fields.dateplantation = parseTime(d.fields.dateplantation)
				  })

				//Sort data chronologically
				filteredData.sort((a,b) => a.fields.dateplantation - b.fields.dateplantation)

				//group data by day of plantation
				var groupedData = d3.nest()
				  .key(function (d) { return d.fields.dateplantation; })
				  .entries(filteredData);

//CLEAN DATA OF CUT DOWN TREES
			const filteredDataCut = data2["records"]
			//Filter out data points that are outside of Paris
				.filter(function(d){
						return d.fields.arrondissement.includes("PARIS")})
			//Format date
				filteredDataCut.forEach(function(d){
					d.fields.datedernierabattage = d.fields.datedernierabattage.substring(0,10);
					d.fields.datedernierabattage = parseTime(d.fields.datedernierabattage)
				})

				//Sort data chronologically
				filteredDataCut.sort((a,b) => a.fields.datedernierabattage - b.fields.datedernierabattage)

				//group data by day of cut
				var groupedDataCut = d3.nest()
				  .key(function (d) { return d.fields.datedernierabattage; })
				  .entries(filteredDataCut);


  function step(){
    // at the end of our data, loop back
    time = (time < groupedData.length +1) ? time + 1 : 0
    console.log(time)
		//clear everything as loop restarts
		if(time == groupedData.length){
			svg.selectAll("circle").remove()
			trees = 0
			felled = 0
		}

    update(groupedData, time)
  }



  // run the code every 0.1 second
	function update(data,time){

		var groupedValuebyKey = groupedData[time]['key']
		var groupedValuebyDay = groupedData[time]['values']


//group data by day of cut
var groupedValuebyDayCut = groupedDataCut
	.filter(function (d,i){
		if(groupedValuebyKey == d.key){
			return groupedDataCut[i]
		}
		else{
			return null
		}
	})


  svg.selectAll("myCircles")
      .data(groupedValuebyDay)
      .enter()
      .append('circle')
      .attr("cx", function(d) {return projection(d.geometry.coordinates)[0]})
      .attr("cy", function(d) {return projection(d.geometry.coordinates)[1]})
      .attr("r", 2)
      .attr("stroke-width", 3)
      .attr("fill-opacity", 1)
      .attr("fill","green")

			if(groupedValuebyDayCut.length >0){
				svg.selectAll("myCirclesCut")
						.data(groupedValuebyDayCut[0].values)
						.enter()
			      .append('circle')
						.attr("cx", function(d) {return projection(d.geometry.coordinates)[0]})
			      .attr("cy", function(d) {return projection(d.geometry.coordinates)[1]})
						.attr("r", 2)
			      .attr("stroke-width", 3)
			      .attr("fill-opacity", 1)
			      .attr("fill","black")

        felled = felled + groupedValuebyDayCut[0].values.length
			}

			 trees = trees + groupedValuebyDay.length


      // update the time label
      timeLabel.text(String(groupedData[time]['key']).substring(4,15));

			// update the count labels
			treeCount.text(trees + " trees planted")
			treeFelled.text(felled + " trees felled")
}

$("#play-button")
	.on("click", function() {
		const button = $(this)
		if (button.text() === "Play") {
			button.text("Pause")
			interval = setInterval(step, 200)
		}
		else {
			button.text("Play")
			clearInterval(interval)
		}
	})

$("#reset-button")
	.on("click", () => {

    svg.selectAll("circle").remove()
		time = 0
		trees = 0
		felled = 0
		update(groupedData, time)


		})

	})


})


</script>


  </body>
</html>
